rules:
  # This is the fixed-rule.
  a.out:
    # 'in' and 'out' section can take complex input.
    in: ${ object.out }
    out: a.out
    # {{ exp }} is a template substituion
    command: gcc {{ self.in }}
  object:
    # If there are 'a.c' and 'b.c', bake runs both 2 command 'gcc -c a.c' and 'gcc -c b.c' in parallel.
    map_source: ${ glob("*.c") }
    map_value:
      in: ${source}
      out: ${ ext("c", ".o", source) }
      command: gcc -c {{source}}
  exe:
    in: a.out
    out: exe
    # Command can be multi-line.
    command: |
      strip a.out
      mv a.out exe
  # If you don't specify out, it become a PHONY target.
  default:
    in: a.out